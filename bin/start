#!/usr/bin/env bash
set -o errexit    # always exit on error
set -o pipefail   # don't ignore exit codes when piping output
set -o nounset    # fail on unset variables

APP_PATH=/app

proc=$1

if [ "$proc" == "" ]; then
  echo "usage: start <process>"
  exit 1
fi

procfile="$APP_PATH/Procfile"

if [ ! -r $procfile ]; then
  echo "cannot read $procfile"
  exit 1
fi

cmd=`cat $APP_PATH/Procfile | grep "^[[:space:]]*$proc[[:space:]]*:" | sed "s/^[[:space:]]*$proc[[:space:]]*:[[:space:]]*//"`

if [ "$cmd" == "" ]; then
  echo "'$proc' process is not in your Procfile"
  exit 1
fi

export DYNO=$proc.`hostname`

eval exec $cmd

